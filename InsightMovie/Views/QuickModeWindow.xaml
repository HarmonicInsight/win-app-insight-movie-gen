<Window x:Class="InsightMovie.Views.QuickModeWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:conv="clr-namespace:InsightMovie.Converters"
        xmlns:shell="clr-namespace:System.Windows.Shell;assembly=PresentationFramework"
        Title="InsightMovie"
        Width="720" Height="640"
        MinWidth="600" MinHeight="500"
        WindowStartupLocation="CenterScreen"
        AllowDrop="True"
        DragEnter="Window_DragEnter"
        DragLeave="Window_DragLeave"
        Drop="Window_Drop"
        Closing="Window_Closing">

    <shell:WindowChrome.WindowChrome>
        <shell:WindowChrome CaptionHeight="40"
                            ResizeBorderThickness="4"
                            GlassFrameThickness="0"
                            CornerRadius="0"
                            UseAeroCaptionButtons="False"/>
    </shell:WindowChrome.WindowChrome>

    <Window.Resources>
        <conv:BoolToVisibilityConverter x:Key="BoolToVis"/>
        <BooleanToVisibilityConverter x:Key="SysBoolToVis"/>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>  <!-- Title bar -->
            <RowDefinition Height="*"/>     <!-- Main content -->
            <RowDefinition Height="Auto"/>  <!-- Log area -->
        </Grid.RowDefinitions>

        <!-- ================================================================ -->
        <!-- Title Bar                                                         -->
        <!-- ================================================================ -->
        <Border Grid.Row="0" Background="{DynamicResource TitlebarBg}"
                BorderBrush="{DynamicResource BorderDefault}" BorderThickness="0,0,0,1">
            <DockPanel>
                <!-- Window controls -->
                <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" VerticalAlignment="Top">
                    <Button x:Name="MinimizeButton" Click="MinimizeButton_Click"
                            Width="46" Height="32" BorderThickness="0"
                            Background="Transparent"
                            shell:WindowChrome.IsHitTestVisibleInChrome="True"
                            ToolTip="最小化">
                        <Path Data="M0,0 H10"
                              Stroke="{DynamicResource TextPrimary}" StrokeThickness="1"
                              VerticalAlignment="Center" HorizontalAlignment="Center"/>
                    </Button>
                    <Button x:Name="MaximizeButton" Click="MaximizeButton_Click"
                            Width="46" Height="32" BorderThickness="0"
                            Background="Transparent"
                            shell:WindowChrome.IsHitTestVisibleInChrome="True"
                            ToolTip="最大化">
                        <Path x:Name="MaximizeIcon" Data="M0,0 H10 V10 H0 Z"
                              Stroke="{DynamicResource TextPrimary}" StrokeThickness="1"
                              VerticalAlignment="Center" HorizontalAlignment="Center"/>
                    </Button>
                    <Button x:Name="CloseButton" Click="CloseButton_Click"
                            Width="46" Height="32" BorderThickness="0"
                            Background="Transparent"
                            shell:WindowChrome.IsHitTestVisibleInChrome="True"
                            ToolTip="閉じる">
                        <Path Data="M0,0 L10,10 M0,10 L10,0"
                              Stroke="{DynamicResource TextPrimary}" StrokeThickness="1"
                              VerticalAlignment="Center" HorizontalAlignment="Center"/>
                    </Button>
                </StackPanel>

                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="14,6,0,6">
                    <TextBlock Text="InsightMovie" FontSize="18" FontWeight="Bold"
                               Foreground="{DynamicResource TitlebarFg}" VerticalAlignment="Center"/>
                    <TextBlock Text="v1.0.0" Foreground="{DynamicResource TitlebarSecondary}" FontSize="11"
                               VerticalAlignment="Bottom" Margin="8,0,0,4"/>
                </StackPanel>
            </DockPanel>
        </Border>

        <!-- ================================================================ -->
        <!-- Main Content                                                      -->
        <!-- ================================================================ -->
        <Grid Grid.Row="1" Margin="24,16,24,8">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>     <!-- Drop zone / Import summary -->
                <RowDefinition Height="Auto"/>  <!-- Settings -->
                <RowDefinition Height="Auto"/>  <!-- Actions -->
                <RowDefinition Height="Auto"/>  <!-- Progress -->
            </Grid.RowDefinitions>

            <!-- ── Drop Zone (shown when no project loaded) ── -->
            <Border x:Name="DropZone" Grid.Row="0"
                    BorderBrush="{DynamicResource BorderDark}"
                    BorderThickness="2" CornerRadius="16"
                    Background="{DynamicResource BgSecondary}"
                    Margin="0,0,0,16" Padding="20"
                    Visibility="{Binding HasProject, Converter={StaticResource BoolToVis}, ConverterParameter=Invert}">

                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                    <!-- Big icon -->
                    <Path Data="M20,4 H4 C2.9,4 2,4.9 2,6 V18 C2,19.1 2.9,20 4,20 H20 C21.1,20 22,19.1 22,18 V6 C22,4.9 21.1,4 20,4 Z M11,15 L6,10 L7.4,8.6 L10,11.2 V5 H12 V11.2 L14.6,8.6 L16,10 L11,15 Z"
                          Fill="{DynamicResource BrandPrimary}"
                          Width="64" Height="64"
                          Stretch="Uniform"
                          HorizontalAlignment="Center" Margin="0,0,0,16"/>

                    <TextBlock Text="ここに資料をドロップ"
                               FontSize="22" FontWeight="Bold"
                               Foreground="{DynamicResource TextPrimary}"
                               HorizontalAlignment="Center" Margin="0,0,0,8"/>

                    <TextBlock Text="PowerPoint (.pptx)・画像・動画・テキストに対応"
                               FontSize="13"
                               Foreground="{DynamicResource TextSecondary}"
                               HorizontalAlignment="Center" Margin="0,0,0,20"/>

                    <Button Content="またはファイルを選択"
                            Padding="20,10"
                            FontSize="13"
                            HorizontalAlignment="Center"
                            shell:WindowChrome.IsHitTestVisibleInChrome="True"
                            Click="SelectFile_Click"/>
                </StackPanel>
            </Border>

            <!-- ── Import Summary (shown after import) ── -->
            <Border Grid.Row="0"
                    BorderBrush="{DynamicResource BorderDefault}"
                    BorderThickness="1" CornerRadius="12"
                    Background="{DynamicResource BgCard}"
                    Margin="0,0,0,16" Padding="24"
                    Visibility="{Binding HasProject, Converter={StaticResource BoolToVis}}">
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                    <!-- Checkmark icon for complete state -->
                    <Path x:Name="CompleteIcon"
                          Data="M12,2 C6.48,2 2,6.48 2,12 C2,17.52 6.48,22 12,22 C17.52,22 22,17.52 22,12 C22,6.48 17.52,2 12,2 Z M10,17 L5,12 L6.41,10.59 L10,14.17 L17.59,6.59 L19,8 L10,17 Z"
                          Fill="{DynamicResource ActionUpdate}"
                          Width="48" Height="48"
                          Stretch="Uniform"
                          HorizontalAlignment="Center" Margin="0,0,0,12"
                          Visibility="{Binding IsComplete, Converter={StaticResource SysBoolToVis}}"/>

                    <!-- Document icon for pre-generate state -->
                    <Path x:Name="DocIcon"
                          Data="M6,2 C4.9,2 4,2.9 4,4 V20 C4,21.1 4.9,22 6,22 H18 C19.1,22 20,21.1 20,20 V8 L14,2 H6 Z M13,9 V3.5 L18.5,9 H13 Z"
                          Fill="{DynamicResource BrandPrimary}"
                          Width="40" Height="40"
                          Stretch="Uniform"
                          HorizontalAlignment="Center" Margin="0,0,0,12"
                          Visibility="{Binding IsComplete, Converter={StaticResource BoolToVis}, ConverterParameter=Invert}"/>

                    <TextBlock Text="{Binding ImportSummary}"
                               FontSize="18" FontWeight="SemiBold"
                               Foreground="{DynamicResource TextPrimary}"
                               HorizontalAlignment="Center" Margin="0,0,0,4"/>

                    <TextBlock Text="{Binding StatusText}"
                               FontSize="13"
                               Foreground="{DynamicResource TextSecondary}"
                               HorizontalAlignment="Center"/>

                    <!-- Output path shown on completion -->
                    <TextBlock Text="{Binding OutputPath}"
                               FontSize="11"
                               Foreground="{DynamicResource TextTertiary}"
                               TextTrimming="CharacterEllipsis"
                               MaxWidth="500"
                               HorizontalAlignment="Center" Margin="0,8,0,0"
                               Visibility="{Binding IsComplete, Converter={StaticResource SysBoolToVis}}"/>
                </StackPanel>
            </Border>

            <!-- ── Settings (speaker + resolution) ── -->
            <Grid Grid.Row="1" Margin="0,0,0,12"
                  Visibility="{Binding ShowSettings, Converter={StaticResource BoolToVis}}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Margin="0,0,8,0">
                    <TextBlock Text="話者" FontSize="12" FontWeight="SemiBold"
                               Foreground="{DynamicResource TextSecondary}" Margin="0,0,0,4"/>
                    <ComboBox ItemsSource="{Binding Speakers}"
                              SelectedIndex="{Binding SelectedSpeakerIndex}"
                              DisplayMemberPath="DisplayName"
                              shell:WindowChrome.IsHitTestVisibleInChrome="True"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Margin="8,0,0,0">
                    <TextBlock Text="向き" FontSize="12" FontWeight="SemiBold"
                               Foreground="{DynamicResource TextSecondary}" Margin="0,0,0,4"/>
                    <ComboBox SelectedIndex="{Binding SelectedResolutionIndex}"
                              shell:WindowChrome.IsHitTestVisibleInChrome="True">
                        <ComboBoxItem Content="縦動画 (9:16)" Tag="1080x1920"/>
                        <ComboBoxItem Content="横動画 (16:9)" Tag="1920x1080"/>
                    </ComboBox>
                </StackPanel>
            </Grid>

            <!-- ── Action Buttons ── -->
            <StackPanel Grid.Row="2" Margin="0,0,0,8">

                <!-- Pre-generate buttons -->
                <Grid Visibility="{Binding ShowSettings, Converter={StaticResource BoolToVis}}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Generate button -->
                    <Button Grid.Column="0"
                            Content="動画を生成"
                            Height="52" FontSize="16" FontWeight="Bold"
                            Style="{DynamicResource PrimaryButton}"
                            Command="{Binding GenerateCommand}"
                            Margin="0,0,8,0"
                            shell:WindowChrome.IsHitTestVisibleInChrome="True"/>

                    <!-- Editor link -->
                    <Button Grid.Column="1"
                            Content="詳細エディタで開く"
                            Height="52" FontSize="13"
                            Padding="20,8"
                            Command="{Binding OpenEditorCommand}"
                            shell:WindowChrome.IsHitTestVisibleInChrome="True"/>
                </Grid>

                <!-- Generating: cancel button -->
                <Button Content="生成をキャンセル"
                        Height="44" FontSize="13"
                        Visibility="{Binding IsGenerating, Converter={StaticResource SysBoolToVis}}"
                        Command="{Binding CancelCommand}"
                        shell:WindowChrome.IsHitTestVisibleInChrome="True"/>

                <!-- Complete: result buttons -->
                <Grid Visibility="{Binding IsComplete, Converter={StaticResource SysBoolToVis}}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Button Grid.Column="0"
                            Content="動画を開く"
                            Height="48" FontSize="14" FontWeight="Bold"
                            Style="{DynamicResource SuccessButton}"
                            Command="{Binding OpenOutputCommand}"
                            Margin="0,0,6,0"
                            shell:WindowChrome.IsHitTestVisibleInChrome="True"/>

                    <Button Grid.Column="1"
                            Content="もう一度作る"
                            Height="48" FontSize="14"
                            Command="{Binding GenerateAnotherCommand}"
                            Margin="6,0,0,0"
                            shell:WindowChrome.IsHitTestVisibleInChrome="True"/>
                </Grid>
            </StackPanel>

            <!-- ── Progress ── -->
            <StackPanel Grid.Row="3"
                        Visibility="{Binding ProgressVisible, Converter={StaticResource SysBoolToVis}}">
                <ProgressBar Value="{Binding ProgressValue}"
                             Maximum="100" Height="8" Margin="0,0,0,4"/>
                <TextBlock Text="{Binding ProgressText}"
                           FontSize="11"
                           Foreground="{DynamicResource TextSecondary}"
                           HorizontalAlignment="Center"/>
            </StackPanel>
        </Grid>

        <!-- ================================================================ -->
        <!-- Log Area (collapsible)                                            -->
        <!-- ================================================================ -->
        <Expander Grid.Row="2" Header="ログ" IsExpanded="False"
                  Margin="8,0,8,4" Padding="0">
            <TextBox x:Name="LogTextBox" IsReadOnly="True"
                     Height="100"
                     VerticalScrollBarVisibility="Auto"
                     HorizontalScrollBarVisibility="Auto"
                     TextWrapping="NoWrap" FontSize="11"
                     FontFamily="Consolas, MS Gothic"
                     Background="{DynamicResource BgSecondary}"/>
        </Expander>
    </Grid>
</Window>
