<Window x:Class="InsightCast.Views.QuickModeWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:conv="clr-namespace:InsightCast.Converters"
        xmlns:shell="clr-namespace:System.Windows.Shell;assembly=PresentationFramework"
        Title="InsightCast"
        Width="720" Height="680"
        MinWidth="600" MinHeight="520"
        WindowStartupLocation="CenterScreen"
        AllowDrop="True"
        DragEnter="Window_DragEnter"
        DragLeave="Window_DragLeave"
        Drop="Window_Drop"
        Closing="Window_Closing">

    <shell:WindowChrome.WindowChrome>
        <shell:WindowChrome CaptionHeight="40"
                            ResizeBorderThickness="4"
                            GlassFrameThickness="0"
                            CornerRadius="0"
                            UseAeroCaptionButtons="False"/>
    </shell:WindowChrome.WindowChrome>

    <Window.Resources>
        <conv:BoolToVisibilityConverter x:Key="BoolToVis"/>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>  <!-- Title bar -->
            <RowDefinition Height="*"/>     <!-- Main content -->
            <RowDefinition Height="Auto"/>  <!-- Log area -->
        </Grid.RowDefinitions>

        <!-- ================================================================ -->
        <!-- Title Bar                                                         -->
        <!-- ================================================================ -->
        <Border Grid.Row="0" Background="{DynamicResource TitlebarBg}"
                BorderBrush="{DynamicResource BorderDefault}" BorderThickness="0,0,0,1">
            <DockPanel>
                <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" VerticalAlignment="Top">
                    <Button Click="LangSwitchButton_Click"
                            Width="60" Height="32" BorderThickness="0"
                            Background="Transparent" FontSize="11"
                            Foreground="{DynamicResource TitlebarSecondary}"
                            shell:WindowChrome.IsHitTestVisibleInChrome="True"
                            Content="{DynamicResource Lang.SwitchTo}"/>
                    <Button x:Name="MinimizeButton" Click="MinimizeButton_Click"
                            Width="46" Height="32" BorderThickness="0"
                            Background="Transparent"
                            shell:WindowChrome.IsHitTestVisibleInChrome="True"
                            ToolTip="{DynamicResource Window.Minimize}">
                        <Path Data="M0,0 H10"
                              Stroke="{DynamicResource TextPrimary}" StrokeThickness="1"
                              VerticalAlignment="Center" HorizontalAlignment="Center"/>
                    </Button>
                    <Button x:Name="MaximizeButton" Click="MaximizeButton_Click"
                            Width="46" Height="32" BorderThickness="0"
                            Background="Transparent"
                            shell:WindowChrome.IsHitTestVisibleInChrome="True"
                            ToolTip="{DynamicResource Window.Maximize}">
                        <Path x:Name="MaximizeIcon" Data="M0,0 H10 V10 H0 Z"
                              Stroke="{DynamicResource TextPrimary}" StrokeThickness="1"
                              VerticalAlignment="Center" HorizontalAlignment="Center"/>
                    </Button>
                    <Button x:Name="CloseButton" Click="CloseButton_Click"
                            Width="46" Height="32" BorderThickness="0"
                            Background="Transparent"
                            shell:WindowChrome.IsHitTestVisibleInChrome="True"
                            ToolTip="{DynamicResource Window.Close}">
                        <Path Data="M0,0 L10,10 M0,10 L10,0"
                              Stroke="{DynamicResource TextPrimary}" StrokeThickness="1"
                              VerticalAlignment="Center" HorizontalAlignment="Center"/>
                    </Button>
                </StackPanel>

                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="14,6,0,6">
                    <TextBlock Text="InsightCast" FontSize="18" FontWeight="Bold"
                               Foreground="{DynamicResource TitlebarFg}" VerticalAlignment="Center"/>
                    <TextBlock x:Name="VersionLabel" Text="v1.0.0" Foreground="{DynamicResource TitlebarSecondary}" FontSize="11"
                               VerticalAlignment="Bottom" Margin="8,0,0,4"/>
                </StackPanel>
            </DockPanel>
        </Border>

        <!-- ================================================================ -->
        <!-- Main Content                                                      -->
        <!-- ================================================================ -->
        <Grid Grid.Row="1" Margin="24,16,24,8">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>     <!-- Drop zone / Import summary -->
                <RowDefinition Height="Auto"/>  <!-- Settings -->
                <RowDefinition Height="Auto"/>  <!-- Actions -->
                <RowDefinition Height="Auto"/>  <!-- Progress -->
            </Grid.RowDefinitions>

            <!-- ── Drop Zone (shown when no project loaded) ── -->
            <Border x:Name="DropZone" Grid.Row="0"
                    BorderBrush="{DynamicResource BorderDark}"
                    BorderThickness="2" CornerRadius="16"
                    Background="{DynamicResource BgSecondary}"
                    Margin="0,0,0,16" Padding="20"
                    Visibility="{Binding HasProject, Converter={StaticResource BoolToVis}, ConverterParameter=Invert}">

                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                    <Path Data="M20,4 H4 C2.9,4 2,4.9 2,6 V18 C2,19.1 2.9,20 4,20 H20 C21.1,20 22,19.1 22,18 V6 C22,4.9 21.1,4 20,4 Z M11,15 L6,10 L7.4,8.6 L10,11.2 V5 H12 V11.2 L14.6,8.6 L16,10 L11,15 Z"
                          Fill="{DynamicResource BrandPrimary}"
                          Width="64" Height="64"
                          Stretch="Uniform"
                          HorizontalAlignment="Center" Margin="0,0,0,16"/>

                    <TextBlock Text="{DynamicResource Quick.DropZone.Title}"
                               FontSize="22" FontWeight="Bold"
                               Foreground="{DynamicResource TextPrimary}"
                               HorizontalAlignment="Center" Margin="0,0,0,8"/>

                    <TextBlock Text="{DynamicResource Quick.DropZone.Subtitle}"
                               FontSize="13"
                               Foreground="{DynamicResource TextSecondary}"
                               HorizontalAlignment="Center" Margin="0,0,0,20"/>

                    <Button Content="{DynamicResource Quick.DropZone.SelectFile}"
                            Padding="20,10"
                            FontSize="13"
                            HorizontalAlignment="Center"
                            shell:WindowChrome.IsHitTestVisibleInChrome="True"
                            Click="SelectFile_Click"/>

                    <Button Content="{DynamicResource Quick.DropZone.BatchImport}"
                            Padding="16,8"
                            FontSize="11" Margin="0,8,0,0"
                            HorizontalAlignment="Center"
                            Foreground="{DynamicResource TextSecondary}"
                            shell:WindowChrome.IsHitTestVisibleInChrome="True"
                            Command="{Binding BatchImportCommand}"
                            ToolTip="{DynamicResource Quick.DropZone.BatchImport.Tooltip}"/>
                </StackPanel>
            </Border>

            <!-- ── Import Summary + Thumbnail Strip (shown after import) ── -->
            <Border Grid.Row="0"
                    BorderBrush="{DynamicResource BorderDefault}"
                    BorderThickness="1" CornerRadius="12"
                    Background="{DynamicResource BgCard}"
                    Margin="0,0,0,16" Padding="16"
                    Visibility="{Binding HasProject, Converter={StaticResource BoolToVis}}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>  <!-- Header: icon + summary -->
                        <RowDefinition Height="*"/>     <!-- Thumbnails -->
                    </Grid.RowDefinitions>

                    <!-- Header -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,8">
                        <!-- Checkmark for complete -->
                        <Path Data="M12,2 C6.48,2 2,6.48 2,12 C2,17.52 6.48,22 12,22 C17.52,22 22,17.52 22,12 C22,6.48 17.52,2 12,2 Z M10,17 L5,12 L6.41,10.59 L10,14.17 L17.59,6.59 L19,8 L10,17 Z"
                              Fill="{DynamicResource ActionUpdate}"
                              Width="24" Height="24" Stretch="Uniform"
                              VerticalAlignment="Center" Margin="0,0,8,0"
                              Visibility="{Binding IsComplete, Converter={StaticResource BoolToVis}}"/>
                        <!-- Doc icon for pre-complete -->
                        <Path Data="M6,2 C4.9,2 4,2.9 4,4 V20 C4,21.1 4.9,22 6,22 H18 C19.1,22 20,21.1 20,20 V8 L14,2 H6 Z M13,9 V3.5 L18.5,9 H13 Z"
                              Fill="{DynamicResource BrandPrimary}"
                              Width="20" Height="20" Stretch="Uniform"
                              VerticalAlignment="Center" Margin="0,0,8,0"
                              Visibility="{Binding IsComplete, Converter={StaticResource BoolToVis}, ConverterParameter=Invert}"/>

                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="{Binding ImportSummary}"
                                       FontSize="15" FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextPrimary}"/>
                            <TextBlock Text="{Binding StatusText}"
                                       FontSize="12"
                                       Foreground="{DynamicResource TextSecondary}"/>
                        </StackPanel>
                    </StackPanel>

                    <!-- Output path on completion -->
                    <TextBlock Grid.Row="0" Text="{Binding OutputPath}"
                               FontSize="10"
                               Foreground="{DynamicResource TextTertiary}"
                               TextTrimming="CharacterEllipsis"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Bottom" Margin="0,0,0,-4"
                               Visibility="{Binding IsComplete, Converter={StaticResource BoolToVis}}"/>

                    <!-- Fix 1: Thumbnail strip -->
                    <ScrollViewer Grid.Row="1"
                                  HorizontalScrollBarVisibility="Auto"
                                  VerticalScrollBarVisibility="Disabled"
                                  Margin="0,4,0,0"
                                  shell:WindowChrome.IsHitTestVisibleInChrome="True">
                        <ItemsControl ItemsSource="{Binding Thumbnails}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Width="100" Height="75"
                                            Margin="4,4,4,4"
                                            CornerRadius="6"
                                            BorderBrush="{DynamicResource BorderDefault}"
                                            BorderThickness="1"
                                            Background="{DynamicResource BgSecondary}"
                                            ToolTip="{Binding Label}">
                                        <Grid>
                                            <!-- Scene image -->
                                            <Image Source="{Binding ImagePath}"
                                                   Stretch="UniformToFill"
                                                   HorizontalAlignment="Center"
                                                   VerticalAlignment="Center"
                                                   Visibility="{Binding HasImage, Converter={StaticResource BoolToVis}}"/>
                                            <!-- Text-only scenes: show label -->
                                            <TextBlock Text="{Binding Label}"
                                                       FontSize="10"
                                                       TextWrapping="Wrap"
                                                       TextTrimming="CharacterEllipsis"
                                                       Foreground="{DynamicResource TextSecondary}"
                                                       Padding="6"
                                                       VerticalAlignment="Center"
                                                       HorizontalAlignment="Center"
                                                       Visibility="{Binding HasImage, Converter={StaticResource BoolToVis}, ConverterParameter=Invert}"/>
                                            <!-- Scene number badge -->
                                            <Border Background="{DynamicResource BrandPrimary}"
                                                    CornerRadius="0,0,6,0"
                                                    Padding="4,1"
                                                    HorizontalAlignment="Left"
                                                    VerticalAlignment="Top">
                                                <TextBlock Text="{Binding Index, StringFormat={}{0}}"
                                                           FontSize="9" FontWeight="Bold"
                                                           Foreground="White"/>
                                            </Border>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Grid>
            </Border>

            <!-- ── Settings (speaker + resolution + extras) ── -->
            <StackPanel Grid.Row="1" Margin="0,0,0,12"
                        Visibility="{Binding ShowSettings, Converter={StaticResource BoolToVis}}">

                <!-- Row 1: Speaker + Resolution -->
                <Grid Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Margin="0,0,8,0">
                        <TextBlock Text="{DynamicResource Quick.Speaker}" FontSize="12" FontWeight="SemiBold"
                                   Foreground="{DynamicResource TextSecondary}" Margin="0,0,0,4"/>
                        <ComboBox ItemsSource="{Binding Speakers}"
                                  SelectedIndex="{Binding SelectedSpeakerIndex}"
                                  DisplayMemberPath="DisplayName"
                                  shell:WindowChrome.IsHitTestVisibleInChrome="True"/>
                    </StackPanel>

                    <Button Grid.Column="1" VerticalAlignment="Bottom"
                            Width="36" Height="30"
                            Margin="0,0,8,0"
                            ToolTip="{DynamicResource Quick.Speaker.Preview.Tooltip}"
                            Command="{Binding PreviewSpeakerCommand}"
                            shell:WindowChrome.IsHitTestVisibleInChrome="True">
                        <Path Data="M8,5 V19 L19,12 Z"
                              Fill="{DynamicResource TextPrimary}"
                              Width="12" Height="12" Stretch="Uniform"
                              HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Button>

                    <StackPanel Grid.Column="2" Margin="0,0,0,0">
                        <TextBlock Text="{DynamicResource Quick.Orientation}" FontSize="12" FontWeight="SemiBold"
                                   Foreground="{DynamicResource TextSecondary}" Margin="0,0,0,4"/>
                        <ComboBox SelectedIndex="{Binding SelectedResolutionIndex}"
                                  shell:WindowChrome.IsHitTestVisibleInChrome="True">
                            <ComboBoxItem Content="{DynamicResource Quick.Res.Portrait}" Tag="1080x1920"/>
                            <ComboBoxItem Content="{DynamicResource Quick.Res.Landscape}" Tag="1920x1080"/>
                        </ComboBox>
                    </StackPanel>
                </Grid>

                <!-- Row 2: Transition + Speech Speed -->
                <Grid Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Margin="0,0,8,0">
                        <TextBlock Text="{DynamicResource Quick.Transition}" FontSize="12" FontWeight="SemiBold"
                                   Foreground="{DynamicResource TextSecondary}" Margin="0,0,0,4"/>
                        <ComboBox ItemsSource="{Binding TransitionOptions}"
                                  SelectedIndex="{Binding SelectedTransitionIndex}"
                                  shell:WindowChrome.IsHitTestVisibleInChrome="True"/>
                    </StackPanel>

                    <StackPanel Grid.Column="1">
                        <TextBlock Text="{DynamicResource Quick.SpeechSpeed}" FontSize="12" FontWeight="SemiBold"
                                   Foreground="{DynamicResource TextSecondary}" Margin="0,0,0,4"/>
                        <ComboBox ItemsSource="{Binding SpeedOptions}"
                                  SelectedIndex="{Binding SelectedSpeedIndex}"
                                  shell:WindowChrome.IsHitTestVisibleInChrome="True"/>
                    </StackPanel>
                </Grid>

                <!-- Row 3: BGM + Thumbnail -->
                <Grid Margin="0,0,0,4">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Margin="0,0,8,0">
                        <TextBlock Text="BGM" FontSize="12" FontWeight="SemiBold"
                                   Foreground="{DynamicResource TextSecondary}" Margin="0,0,0,4"/>
                        <DockPanel>
                            <Button DockPanel.Dock="Right" Content="✕" Width="28" Height="28"
                                    Margin="4,0,0,0"
                                    ToolTip="{DynamicResource Watermark.Clear.Tooltip}"
                                    Command="{Binding ClearBgmCommand}"
                                    Visibility="{Binding HasBgm, Converter={StaticResource BoolToVis}}"
                                    shell:WindowChrome.IsHitTestVisibleInChrome="True"/>
                            <Button Content="{Binding BgmFileName}"
                                    Height="28" FontSize="11"
                                    HorizontalContentAlignment="Left"
                                    Padding="8,0"
                                    Command="{Binding SelectBgmCommand}"
                                    ToolTip="{DynamicResource BGM.SelectFile}"
                                    shell:WindowChrome.IsHitTestVisibleInChrome="True"/>
                        </DockPanel>
                    </StackPanel>

                    <StackPanel Grid.Column="1" VerticalAlignment="Bottom">
                        <CheckBox Content="{DynamicResource Quick.Thumbnail}"
                                  IsChecked="{Binding GenerateThumbnailEnabled}"
                                  FontSize="11"
                                  Foreground="{DynamicResource TextSecondary}"
                                  shell:WindowChrome.IsHitTestVisibleInChrome="True"/>
                    </StackPanel>
                </Grid>

                <!-- Row 4: Intro/Outro -->
                <Grid Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Margin="0,0,8,0">
                        <TextBlock Text="{DynamicResource IntroOutro.Intro.Short}" FontSize="12" FontWeight="SemiBold"
                                   Foreground="{DynamicResource TextSecondary}" Margin="0,0,0,4"/>
                        <DockPanel>
                            <Button DockPanel.Dock="Right" Content="✕" Width="24" Height="24"
                                    Margin="4,0,0,0"
                                    Command="{Binding ClearIntroCommand}"
                                    Visibility="{Binding HasIntro, Converter={StaticResource BoolToVis}}"
                                    shell:WindowChrome.IsHitTestVisibleInChrome="True"/>
                            <Button Content="{Binding IntroFileName}"
                                    Height="24" FontSize="10"
                                    HorizontalContentAlignment="Left" Padding="6,0"
                                    Command="{Binding SelectIntroCommand}"
                                    ToolTip="{DynamicResource IntroOutro.Intro.Tooltip}"
                                    shell:WindowChrome.IsHitTestVisibleInChrome="True"/>
                        </DockPanel>
                    </StackPanel>

                    <StackPanel Grid.Column="1">
                        <TextBlock Text="{DynamicResource IntroOutro.Outro.Short}" FontSize="12" FontWeight="SemiBold"
                                   Foreground="{DynamicResource TextSecondary}" Margin="0,0,0,4"/>
                        <DockPanel>
                            <Button DockPanel.Dock="Right" Content="✕" Width="24" Height="24"
                                    Margin="4,0,0,0"
                                    Command="{Binding ClearOutroCommand}"
                                    Visibility="{Binding HasOutro, Converter={StaticResource BoolToVis}}"
                                    shell:WindowChrome.IsHitTestVisibleInChrome="True"/>
                            <Button Content="{Binding OutroFileName}"
                                    Height="24" FontSize="10"
                                    HorizontalContentAlignment="Left" Padding="6,0"
                                    Command="{Binding SelectOutroCommand}"
                                    ToolTip="{DynamicResource IntroOutro.Outro.Tooltip}"
                                    shell:WindowChrome.IsHitTestVisibleInChrome="True"/>
                        </DockPanel>
                    </StackPanel>
                </Grid>

                <!-- Row 5: Watermark + Template -->
                <Grid Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Margin="0,0,8,0">
                        <TextBlock Text="{DynamicResource Watermark.Short}" FontSize="12" FontWeight="SemiBold"
                                   Foreground="{DynamicResource TextSecondary}" Margin="0,0,0,4"/>
                        <DockPanel>
                            <ComboBox DockPanel.Dock="Right" Width="56"
                                      ItemsSource="{Binding WatermarkPositionOptions}"
                                      SelectedIndex="{Binding SelectedWatermarkPosIndex}"
                                      Margin="4,0,0,0"
                                      Visibility="{Binding HasWatermark, Converter={StaticResource BoolToVis}}"
                                      shell:WindowChrome.IsHitTestVisibleInChrome="True"/>
                            <Button DockPanel.Dock="Right" Content="✕" Width="24" Height="24"
                                    Margin="4,0,0,0"
                                    Command="{Binding ClearWatermarkCommand}"
                                    Visibility="{Binding HasWatermark, Converter={StaticResource BoolToVis}}"
                                    shell:WindowChrome.IsHitTestVisibleInChrome="True"/>
                            <Button Content="{Binding WatermarkFileName}"
                                    Height="24" FontSize="10"
                                    HorizontalContentAlignment="Left" Padding="6,0"
                                    Command="{Binding SelectWatermarkCommand}"
                                    ToolTip="{DynamicResource Watermark.Tooltip}"
                                    shell:WindowChrome.IsHitTestVisibleInChrome="True"/>
                        </DockPanel>
                    </StackPanel>

                    <Button Grid.Column="1"
                            Content="{DynamicResource Template.Save}"
                            Height="24" FontSize="10" Padding="8,0"
                            Margin="0,18,4,0"
                            Command="{Binding SaveTemplateCommand}"
                            ToolTip="{DynamicResource Template.Save.Tooltip}"
                            shell:WindowChrome.IsHitTestVisibleInChrome="True"/>
                    <Button Grid.Column="2"
                            Content="{DynamicResource Template.Load}"
                            Height="24" FontSize="10" Padding="8,0"
                            Margin="0,18,0,0"
                            Command="{Binding LoadTemplateCommand}"
                            ToolTip="{DynamicResource Template.Load.Tooltip}"
                            shell:WindowChrome.IsHitTestVisibleInChrome="True"/>
                </Grid>
            </StackPanel>

            <!-- ── Action Buttons ── -->
            <StackPanel Grid.Row="2" Margin="0,0,0,8">

                <!-- Pre-generate buttons -->
                <Grid Visibility="{Binding ShowSettings, Converter={StaticResource BoolToVis}}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <Button Grid.Column="0"
                            Content="{DynamicResource Quick.Generate}"
                            Height="52" FontSize="16" FontWeight="Bold"
                            Style="{DynamicResource PrimaryButton}"
                            Command="{Binding GenerateCommand}"
                            Margin="0,0,8,0"
                            shell:WindowChrome.IsHitTestVisibleInChrome="True"/>

                    <Button Grid.Column="1"
                            Content="{DynamicResource Quick.OpenEditor}"
                            Height="52" FontSize="13"
                            Padding="20,8"
                            Command="{Binding OpenEditorCommand}"
                            shell:WindowChrome.IsHitTestVisibleInChrome="True"/>
                </Grid>

                <!-- Generating: cancel button -->
                <Button Content="{DynamicResource Quick.CancelGenerate}"
                        Height="44" FontSize="13"
                        Visibility="{Binding IsGenerating, Converter={StaticResource BoolToVis}}"
                        Command="{Binding CancelCommand}"
                        shell:WindowChrome.IsHitTestVisibleInChrome="True"/>

                <!-- Complete buttons with output folder access -->
                <Grid Visibility="{Binding IsComplete, Converter={StaticResource BoolToVis}}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Button Grid.Row="0" Grid.Column="0"
                            Content="{DynamicResource Quick.OpenVideo}"
                            Height="48" FontSize="13" FontWeight="Bold"
                            Style="{DynamicResource SuccessButton}"
                            Command="{Binding OpenOutputCommand}"
                            Margin="0,0,4,0"
                            shell:WindowChrome.IsHitTestVisibleInChrome="True"/>

                    <Button Grid.Row="0" Grid.Column="1"
                            Content="{DynamicResource Quick.Regenerate}"
                            Height="48" FontSize="13"
                            Command="{Binding GenerateAnotherCommand}"
                            Margin="4,0,4,0"
                            ToolTip="{DynamicResource Quick.Regenerate.Tooltip}"
                            shell:WindowChrome.IsHitTestVisibleInChrome="True"/>

                    <Button Grid.Row="0" Grid.Column="2"
                            Content="{DynamicResource Quick.NewMaterial}"
                            Height="48" FontSize="13"
                            Command="{Binding ResetAllCommand}"
                            Margin="4,0,0,0"
                            shell:WindowChrome.IsHitTestVisibleInChrome="True"/>

                    <!-- Extra output access row -->
                    <Button Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3"
                            Content="{DynamicResource Quick.OpenOutputFolder}"
                            Height="30" FontSize="11"
                            Margin="0,6,0,0"
                            Command="{Binding OpenOutputFolderCommand}"
                            ToolTip="{DynamicResource Quick.OpenOutputFolder.Tooltip}"
                            Visibility="{Binding HasExtraOutputs, Converter={StaticResource BoolToVis}}"
                            shell:WindowChrome.IsHitTestVisibleInChrome="True"/>
                </Grid>
            </StackPanel>

            <!-- ── Progress ── -->
            <StackPanel Grid.Row="3"
                        Visibility="{Binding ProgressVisible, Converter={StaticResource BoolToVis}}">
                <!-- Fix 4: IsIndeterminate during import (no known total) -->
                <ProgressBar Value="{Binding ProgressValue}"
                             IsIndeterminate="{Binding IsImporting}"
                             Maximum="100" Height="8" Margin="0,0,0,4"/>
                <TextBlock Text="{Binding ProgressText}"
                           FontSize="11"
                           Foreground="{DynamicResource TextSecondary}"
                           HorizontalAlignment="Center"/>
            </StackPanel>
        </Grid>

        <!-- Fix 7: D&D overlay (shown when dragging onto window while HasProject=true) -->
        <Border x:Name="DragOverlay" Grid.Row="1"
                Background="#C0FFFFFF"
                CornerRadius="12"
                Margin="24,16,24,8"
                Visibility="Collapsed">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <Path Data="M20,4 H4 C2.9,4 2,4.9 2,6 V18 C2,19.1 2.9,20 4,20 H20 C21.1,20 22,19.1 22,18 V6 C22,4.9 21.1,4 20,4 Z M11,15 L6,10 L7.4,8.6 L10,11.2 V5 H12 V11.2 L14.6,8.6 L16,10 L11,15 Z"
                      Fill="{DynamicResource BrandPrimary}"
                      Width="48" Height="48"
                      Stretch="Uniform"
                      HorizontalAlignment="Center" Margin="0,0,0,12"/>
                <TextBlock Text="{DynamicResource Quick.DropReplace}"
                           FontSize="18" FontWeight="Bold"
                           Foreground="{DynamicResource TextPrimary}"
                           HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>

        <!-- ================================================================ -->
        <!-- Log Area (collapsible)                                            -->
        <!-- ================================================================ -->
        <Expander Grid.Row="2" Header="{DynamicResource Quick.Log}" IsExpanded="False"
                  Margin="8,0,8,4" Padding="0">
            <TextBox x:Name="LogTextBox" IsReadOnly="True"
                     Height="100"
                     VerticalScrollBarVisibility="Auto"
                     HorizontalScrollBarVisibility="Auto"
                     TextWrapping="NoWrap" FontSize="11"
                     FontFamily="Consolas, MS Gothic"
                     Background="{DynamicResource BgSecondary}"/>
        </Expander>

        <!-- Fix 2: Hidden MediaElement for speaker preview -->
        <MediaElement x:Name="AudioPlayer" Grid.Row="0"
                      LoadedBehavior="Manual" UnloadedBehavior="Stop"
                      MediaEnded="AudioPlayer_MediaEnded"
                      Visibility="Collapsed"/>
    </Grid>
</Window>
